<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plea Helper - Tickety</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <header class="app-header">
             <a href="{{ url_for('index') }}" class="back-button"><span class="material-icons">arrow_back</span></a>
             <h1 style="margin-left: 1rem;">Plea Helper</h1>
        </header>
        <main class="app-main">
            <div class="action-card">
                <h2>Copy Your Information</h2>
                <p class="helper-subtitle">Tap 'Copy' then paste into the form on the Montreal portal.</p>

                <!-- Profile Information -->
                <div class="copy-group">
                    <label>First Name</label>
                    <div class="copy-item">
                        <input type="text" value="{{ profile.first_name }}" readonly>
                        <button class="copy-btn"><span class="material-icons">content_copy</span> Copy</button>
                    </div>
                </div>
                <div class="copy-group">
                    <label>Last Name</label>
                    <div class="copy-item">
                        <input type="text" value="{{ profile.last_name }}" readonly>
                        <button class="copy-btn"><span class="material-icons">content_copy</span> Copy</button>
                    </div>
                </div>
                <div class="copy-group">
                    <label>Driver's License</label>
                    <div class="copy-item">
                        <input type="text" value="{{ profile.license }}" readonly>
                        <button class="copy-btn"><span class="material-icons">content_copy</span> Copy</button>
                    </div>
                </div>
                <div class="copy-group">
                    <label>Address</label>
                    <div class="copy-item">
                        <input type="text" value="{{ profile.address }}" readonly>
                        <button class="copy-btn"><span class="material-icons">content_copy</span> Copy</button>
                    </div>
                </div>
                <div class="copy-group">
                    <label>City</label>
                    <div class="copy-item">
                        <input type="text" value="{{ profile.city }}" readonly>
                        <button class="copy-btn"><span class="material-icons">content_copy</span> Copy</button>
                    </div>
                </div>
                <div class="copy-group">
                    <label>Postal Code</label>
                    <div class="copy-item">
                        <input type="text" value="{{ profile.postal_code }}" readonly>
                        <button class="copy-btn"><span class="material-icons">content_copy</span> Copy</button>
                    </div>
                </div>
                <div class="copy-group">
                    <label>Email</label>
                    <div class="copy-item">
                        <input type="text" value="{{ profile.email }}" readonly>
                        <button class="copy-btn"><span class="material-icons">content_copy</span> Copy</button>
                    </div>
                </div>

                <div class="divider"></div>

                <!-- Not Guilty Plea Section -->
                <form method="POST">
                    <h2>Not Guilty Plea Explanation</h2>
                    <div class="copy-group">
                        <textarea name="plea_text" placeholder="Explain why you are pleading not guilty...">{{ plea_text or '' }}</textarea>
                        <div class="copy-item">
                             <button type="button" class="copy-btn textarea-copy-btn"><span class="material-icons">content_copy</span> Copy Explanation</button>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-secondary">Save Explanation</button>
                </form>

                <div class="divider"></div>

                <a href="{{ montreal_url }}" target="_blank" class="btn btn-success">
                    <span class="material-icons">open_in_new</span> Open Montreal Portal
                </a>

            </div>
        </main>
    </div>

    <script>
        document.querySelectorAll('.copy-btn').forEach(button => {
            button.addEventListener('click', (e) => {
                e.preventDefault();
                let input;
                // Check if it's the button for the textarea
                if (button.classList.contains('textarea-copy-btn')) {
                    input = button.closest('.copy-group').querySelector('textarea');
                } else {
                    input = button.previousElementSibling;
                }
                
                input.select();
                try {
                    // Use the modern clipboard API
                    navigator.clipboard.writeText(input.value);
                    const originalText = button.innerHTML;
                    button.innerHTML = '<span class="material-icons">done</span> Copied!';
                    setTimeout(() => {
                        button.innerHTML = originalText;
                    }, 2000);
                } catch (err) {
                    console.error('Failed to copy text: ', err);
                    // Fallback for older browsers
                    try {
                        document.execCommand('copy');
                        const originalText = button.innerHTML;
                        button.innerHTML = '<span class="material-icons">done</span> Copied!';
                        setTimeout(() => {
                            button.innerHTML = originalText;
                        }, 2000);
                    } catch (err) {
                        alert('Failed to copy text.');
                    }
                }
            });
        });
    </script>
</body>
</html>
